sap.ui.define(["sap/ui/base/Object","sap/m/MessageToast","sap/ui/generic/app/util/ModelUtil","sap/ui/generic/app/util/ActionUtil","sap/suite/ui/generic/template/lib/MessageUtils"],function(B,M,a,A,b){"use strict";function g(c,C,s,o,d){var r=Promise.reject();r.catch(jQuery.noop);function h(O,i,E,P){b.handleError(O,c,o.getContentDensityClass(),s,E,P);return(i||jQuery.noop)(E);}function e(){b.handleTransientMessages(o.getDialogFragment);}function f(P){return new Promise(function(j,w){s.oTransactionController.editEntity(c.getView().getBindingContext(),P).then(function(R){C.rebindHeaderData(R.context.getPath());e(R);return j(R.context);},function(R){if(R&&R.response&&R.response.statusCode==='409'&&P){R.unsavedChanges=true;var x=sap.ui.getCore().getMessageManager();var y=x.getMessageModel().oData;var z=[];for(var i=0;i<y.length;i++){if(y[i].getCode()==="SDRAFT_COMMON/000"){z.push(y[i]);}}if(z.length>0){x.removeMessages(z);}return j(R);}else{h(b.operations.editEntity,w,R,R);}});});}function k(D){var i=c.getView().getBindingContext();var I=s.oDraftController.isActiveEntity(i);var H=s.oDraftController.hasActiveEntity(i);return new Promise(function(j,w){var E=function(x){c.getOwnerComponent().getComponentContainer().bindElement(i.getPath());return h(b.operations.deleteEntity,w,x);};if(I&&D){s.oDraftController.getDraftForActiveEntity(i).then(function(R){s.oTransactionController.deleteEntity(R.context).then(function(){setTimeout(function(){M.show(o.getText("ST_GENERIC_DRAFT_WITH_ACTIVE_DOCUMENT_DELETED"));},50);return j();});},E);}else{s.oTransactionController.deleteEntity(i).then(function(){var x=a.getEntitySetFromContext(i);var y=s.oDraftController.getDraftContext();var R=y.isDraftRoot(x);var z=o.getText("ST_GENERIC_OBJECT_DELETED");if(!I&&R){z=o.getText(H?"ST_GENERIC_DRAFT_WITH_ACTIVE_DOCUMENT_DELETED":"ST_GENERIC_DRAFT_WITHOUT_ACTIVE_DOCUMENT_DELETED");}setTimeout(function(){M.show(z);},50);return j();},E);}});}function l(P){return new Promise(function(w,x){s.oTransactionController.deleteEntities(P).then(function(D){var F=[];var O=sap.ui.getCore().getMessageManager().getMessageModel().getData();for(var i=0;i<O.length;i++){var y=O[i].getTarget();for(var j=0;j<P.length;j++){if(y.indexOf(P[j])>-1){F.push(y);break;}}}return w(F);},function(E){return x(E);});});}function m(V,i){return new Promise(function(j,w){var x=c.getOwnerComponent();var E=x.getEntitySet();if(!s.oDraftController.getDraftContext().isDraftEnabled(E)){return j();}var y=x.getComponentContainer().getElementBinding();s[i?"oApplicationController":"oTransactionController"].propertyChanged(E,V,y,i).then(function(){return j();},h.bind(null,b.operations.modifyEntity,w));});}function n(){return new Promise(function(i,j){s.oTransactionController.triggerSubmitChanges().then(function(R){e();return i(R.context);},h.bind(null,b.operations.saveEntity,j));});}function p(){return new Promise(function(i,j){s.oDraftController.activateDraftEntity(c.getView().getBindingContext()).then(function(R){var w=c.getOwnerComponent();var x=w.getComponentContainer();x.unbindElement();C.rebindHeaderData(R.context.getPath());x.getObjectBinding().refresh(true);e();return i(R);},h.bind(null,b.operations.activateDraftEntity,j));});}function q(P){return new A(P);}function t(P,R,i){if(d.isBusy()){i();return;}var F=P.functionImportPath;var j=P.contexts;var S=P.sourceControl;var w=P.label;var N=P.navigationProperty;var x=q({controller:c,contexts:j,applicationController:s.oApplicationController});var y=function(D){var E,G;if(jQuery.isArray(D)&&D.length===1){E=D[0];G=E.response&&E.response.context;if(G&&G!==E.actionContext&&G.getPath()!=="/undefined"){if(S){o.navigateFromListItem(G,S);}else{s.oNavigationController.navigateToContext(G,N,false);}}}R(D);};var z=function(E){if(!jQuery.isArray(E)){var D={context:j};h(b.operations.callAction,null,E,D);i(E);}};x.call(F,w).then(function(D){if(D&&D.executionPromise){d.setBusy(D.executionPromise);D.executionPromise.then(y,z);}else{if(!D){i();}else{y(D);}}},function(E){if(!E){i();}else{z(E);}});}function u(P){var R=new Promise(function(i,j){t(P,i,j);});return R;}function v(T){if(!T){throw new Error("Unknown Table");}var i="";var j="";var E=c.getOwnerComponent().getEntitySet();var w,x,N,y;var V=c.getView();var z=V.getModel();var D=V.getBindingContext();if(D){j=o.getTableBinding(T).path;y=z.getMetaModel();x=y.getODataEntitySet(E);w=y.getODataEntityType(x.entityType);N=y.getODataAssociationSetEnd(w,j);if(N){E=N.entitySet;}j="/"+j;i=D.getPath()+j;}else{i="/"+E;}return new Promise(function(F,G){if(s.oDraftController.getDraftContext().isDraftEnabled(E)){s.oDraftController.createNewDraftEntity(E,i).then(function(R){return F({newContext:R.context,tableBindingPath:j});},h.bind(null,b.operations.addEntry,G));}else{var H=z.createEntry(i,{batchGroupId:"Changes",changeSetId:"Changes"});return F({newContext:H,tableBindingPath:j});}});}return{editEntity:f,deleteEntity:k,deleteEntities:l,modifyEntity:m,saveEntity:n,activateDraftEntity:p,callAction:u,addEntry:v};}return B.extend("sap.suite.ui.generic.template.lib.CRUDManager.js",{constructor:function(c,C,s,o,d){jQuery.extend(this,g(c,C,s,o,d));}});});
