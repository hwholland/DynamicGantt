sap.ui.define(["sap/ui/core/mvc/View","sap/ui/model/resource/ResourceModel","sap/suite/ui/generic/template/lib/TemplateViewController","sap/suite/ui/generic/template/lib/TemplateComponent","sap/suite/ui/generic/template/lib/Application","sap/suite/ui/generic/template/lib/CRUDManager","sap/suite/ui/generic/template/lib/CommonUtils","sap/suite/ui/generic/template/lib/ComponentUtils","sap/suite/ui/generic/template/lib/CommonEventHandlers"],function(V,R,T,a,A,C,b,c,d){"use strict";var f;var m={};var e={};var g={};var r;function h(){r=r||new R({bundleName:"sap/suite/ui/generic/template/lib/i18n/i18n"}).getResourceBundle();return r.getText.apply(r,arguments);}function i(o,l){var I=o.getId();var n=m[I];if(l){delete m[I];}return n;}function j(o){return function(){var l=i(o);if(l.oActiveComponentRegistryEntry&&l.oActiveComponentRegistryEntry.oController){var v=l.oActiveComponentRegistryEntry.oController.getView();var I=v.getId();return g[I].oTemplateUtils.oCommonUtils.getDialogFragment.apply(null,arguments);}};}function k(o){return e[o.getId()];}function F(o){while(o&&!(o instanceof V)){o=o.getParent();}return o;}function G(o){while(o){var v=F(o);var l=v&&v.getController();var n=l&&l.getOwnerComponent();if(n instanceof a){var p=k(n);return p;}else{o=n&&n.oContainer;}}}return{getTemplateController:function(l,s,o){o=o||{};o.constructor=function(){var t={};var M=l(t,this);this._templateEventHandlers=Object.freeze(M.handlers||{});this._templateFormatters=Object.freeze(M.formatters||{});this.extensionAPI=Object.freeze(M.extensionAPI||{});this.fnGenericOnInit=function(n){var v=n.getView();var I=v.getId();jQuery.sap.log.info("Init view "+I+" of template "+s);g[I]={onExit:M.onExit||jQuery.noop,oTemplateUtils:t};var p=n.getOwnerComponent();var q=k(p);t.oComponentUtils=q.utils;t.oComponentAPI=q.methods.forView;var u=p.getAppComponent();var w=i(u);var x=u.getTransactionController();t.oServices={oApplicationController:u.getApplicationController(),oTransactionController:x,oNavigationController:u.getNavigationController(),oDraftController:x.getDraftController()};t.oServices.oApplicationController.registerView(v);t.oCommonUtils=new b(n,t.oServices);t.oServices.oCRUDManager=new C(n,t.oComponentUtils,t.oServices,t.oCommonUtils,w.oTemplateContract.oBusyHelper);t.oCommonEventHandlers=new d(n,t.oComponentUtils,t.oServices,t.oCommonUtils);v.addStyleClass(t.oCommonUtils.getContentDensityClass());(M.onInit||jQuery.noop)();q.fnViewRegisteredResolve(M.onBeforePageDisplay||jQuery.noop);q.oController=this;delete q.fnViewRegisteredResolve;};};o.onInit=function(){this.fnGenericOnInit(this);delete this.fnGenericOnInit;};o.onExit=function(){var I=this.getView().getId();g[I].onExit();delete g[I];jQuery.sap.log.info("View "+I+" of template "+s+" exited");};return T.extend(s,o);},getTemplateComponent:function(l,s,o){o=o||{};o.init=function(){var p={};var v=new Promise(function(q){p.fnViewRegisteredResolve=q;});(a.prototype.init||jQuery.noop).apply(this,arguments);p.componentName=s;p.oComponent=this;p.utils=new c(this,p);p.methods=l(this,p.utils)||{};p.viewRegisterd=v;p.oGenericData={mRefreshInfos:{}};e[this.getId()]=p;var O=jQuery.extend({},p.methods.overwrite);delete O.init;delete O.exit;delete O.setContainer;delete O.onActivate;jQuery.extend(this,O);(p.methods.init||jQuery.noop)();};o.exit=function(){var I=this.getId();var M=k(this).methods;(M.exit||jQuery.noop)();delete e[I];(a.prototype.exit||jQuery.noop).apply(this,arguments);};var n;o.onActivate=function(B){n=B;var p=this.getAppComponent();var q=i(p);if(q.oActiveComponentRegistryEntry){q.oActiveComponentRegistryEntry.isActive=false;}q.oActiveComponentRegistryEntry=k(this);q.oActiveComponentRegistryEntry.isActive=true;q.oActiveComponentRegistryEntry.viewRegisterd.then(function(t){q.oActiveComponentRegistryEntry.utils.bindComponent(n);this.getModel("message").refresh(true);t();var u=this.getIsRefreshRequired();if(u||!jQuery.isEmptyObject(q.oActiveComponentRegistryEntry.oGenericData.mRefreshInfos)){(q.oActiveComponentRegistryEntry.methods.refreshBinding||jQuery.noop)(u,u?{}:q.oActiveComponentRegistryEntry.oGenericData.mRefreshInfos);this.setIsRefreshRequired(false);q.oActiveComponentRegistryEntry.oGenericData.mRefreshInfos={};}(q.oActiveComponentRegistryEntry.methods.onActivate||jQuery.noop)(B);}.bind(this));};o.setContainer=function(){a.prototype.setContainer.apply(this,arguments);var p=k(this);if(!p.oApplication){var q=this.getAppComponent();var t=i(q);t.oTemplateContract.oBusyHelper.setBusy(p.viewRegisterd,true);p.oApplication=t.application;}(p.methods.setContainer||jQuery.noop)();};o.onDeactivate=jQuery.noop;return a.extend(s,o);},getAppComponent:function(l,n,s,o){o=o||{};o.constructor=function(){var p={appComponent:this,oTemplateContract:{componentRegistry:e,getDialogFragment:j(this),getText:h,hasView:function(){return!!(p.oActiveComponentRegistryEntry&&p.oActiveComponentRegistryEntry.oController);}}};p.application=new A(p.oTemplateContract);p.methods=l(this,p.oTemplateContract);var P=jQuery.extend({},p.methods.publicMethods);delete P.init;delete P.exit;jQuery.extend(this,P);f=p.methods.init||jQuery.noop;(n.prototype.constructor||jQuery.noop).apply(this,arguments);m[this.getId()]=p;};o.init=function(){(n.prototype.init||jQuery.noop).apply(this,arguments);f();f=null;};o.exit=function(){var p=i(this,true);(p.methods.exit||jQuery.noop)();(n.prototype.exit||jQuery.noop).apply(this,arguments);};return n.extend(s,o);},getExtensionAPIPromise:function(o){var l=G(o);if(!l){return Promise.reject();}return l.viewRegisterd.then(function(){return l.oController.extensionAPI;});},getExtensionAPI:function(o){var l=G(o);return l&&l.oController&&l.oController.extensionAPI;}};});
