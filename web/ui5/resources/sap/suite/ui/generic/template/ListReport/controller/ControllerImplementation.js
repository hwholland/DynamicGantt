sap.ui.define(["sap/ui/base/Object","sap/ui/model/json/JSONModel","sap/m/ObjectIdentifier","sap/m/Table","sap/m/Text","sap/ui/comp/smartfield/SmartField","sap/ui/generic/app/navigation/service/SelectionVariant","sap/suite/ui/generic/template/ListReport/extensionAPI/ExtensionAPI"],function(B,J,O,T,a,S,b,E){"use strict";var c="sap.suite.ui.generic.template.customData",g="sap.suite.ui.generic.template.genericData";function n(o){if(o){for(var p in o){o[p]=null;}}}return{getMethods:function(t,C){var s={};function d(){var o={};o[c]={};o[g]={};var i=C.byId("editStateFilter");if(i){o[g].editStateFilter=i.getSelectedKey();}C.getCustomAppStateDataExtension(o[c]);return o;}function e(){var o=new b(s.oSmartFilterbar.getDataSuiteFormat());var v=C.getVisibleSelectionsWithDefaults();for(var i=0;i<v.length;i++){if(!o.getValue(v[i])){o.addSelectOption(v[i],"I","EQ","");}}return{selectionVariant:o.toJSONString(),tableVariantId:s.oSmartTable.getCurrentVariantId(),customData:d()};}function f(o){o=o||e();try{t.oCommonUtils.getNavigationHandler().storeInnerAppState(o);}catch(i){jQuery.sap.log.error("ListReport.fnStoreCurrentAppStateAndAdjustURL: "+i);}}function h(){var o=C.getOwnerComponent();var i=o.getModel("_templPriv");i.setProperty("/listReport/isLeaf",o.getIsLeaf());}function j(){var o=C.getOwnerComponent();var i=o.getComponentContainer().getSettings();var p=o.getModel("_templPriv");var q="";q=t.oCommonUtils.getText("BACK");var P=i.routeConfig.parentEntitySet;var M="";if(P!==undefined&&P!==""){var u=o.getModel().getMetaModel();var v=u.getODataEntitySet(P);var w=u.getODataEntityType(v.entityType);var H=w["com.sap.vocabularies.UI.v1.HeaderInfo"];if(H&&H.TypeName&&H.TypeName.String!==""){M=H.TypeName.String;q=t.oCommonUtils.getText("BACK_TO_MAIN",M);}}p.setProperty("/complexTable/backToMain",q);}function k(){var G=jQuery.sap.getObject("sap.ushell.Container.getUser");var M=C.getOwnerComponent().getAppComponent().getMetadata().getManifestEntry("sap.ui");var i=(M&&M.icons&&M.icons.icon)||"";var o={bookmarkIcon:i,bookmarkCustomUrl:function(){f();return hasher.getHash()?("#"+hasher.getHash()):window.location.href;},bookmarkServiceUrl:function(){var q=s.oSmartTable.getTable();var u=q.getBinding("rows")||q.getBinding("items");return u?u.getDownloadUrl()+"&$top=0&$inlinecount=allpages":"";},isShareInJamActive:!!G&&G().isJamActive()};var p=C.getOwnerComponent().getModel("_templPriv");p.setProperty("/listReport/share",o);}function r(G){if(G&&G.editStateFilter!==undefined){var o=C.byId("editStateFilter");if(o){o.setSelectedKey((G.editStateFilter===null)?0:G.editStateFilter);}}}function R(o){C.restoreCustomAppStateDataExtension(o||{});}function l(o){o=o||{};if(o.hasOwnProperty(c)&&o.hasOwnProperty(g)){r(o[g]);R(o[c]);}else{if(o._editStateFilter!==undefined){r({editStateFilter:o._editStateFilter});delete o._editStateFilter;}R(o);}}function I(){var p=t.oCommonUtils.getNavigationHandler().parseNavigation();p.done(function(A,u,o){if(o!==sap.ui.generic.app.navigation.service.NavType.initial){var H=A&&A.bNavSelVarHasDefaultsOnly;var q=new b(A.selectionVariant);var v=q.getParameterNames().concat(q.getSelectOptionsPropertyNames());for(var i=0;i<v.length;i++){s.oSmartFilterbar.addFieldToAdvancedArea(v[i]);}if(H&&s.oSmartFilterbar.isCurrentVariantStandard()){s.oSmartFilterbar.setDataSuiteFormat(A.selectionVariant);}else if(!H||s.oSmartFilterbar.isCurrentVariantStandard()){s.oSmartFilterbar.clearVariantSelection();s.oSmartFilterbar.clear();s.oSmartFilterbar.setDataSuiteFormat(A.selectionVariant,true);}if(A.tableVariantId){s.oSmartTable.setCurrentVariantId(A.tableVariantId);}l(A.customData);if(!H){s.oSmartFilterbar.search();}}});p.fail(function(o){if(o instanceof Error){o.showMessageBox();}});}var N;function m(){N=N||t.oCommonUtils.getText("CREATE_NEW_OBJECT_DYN",[C.byId("idEntityTypeName").getValue()]);return N;}return{onInit:function(){s.oSmartFilterbar=C.byId("listReportFilter");s.oSmartTable=C.byId("listReport");h();k();var o=C.getOwnerComponent();var i=o.getComponentContainer().getSettings();var p=sap.suite.ui.generic.template.js.AnnotationHelper.isComplexTable(i.routeConfig);if(p){j();}},handlers:{onBack:function(){window.history.back();},addEntry:function(o){t.oCommonEventHandlers.addEntry(o).then(function(){t.oComponentUtils.addDataForNextPage({isObjectRoot:true});});},deleteEntries:function(o){t.oCommonEventHandlers.deleteEntries(o);},onChange:function(o){t.oCommonEventHandlers.onChange(o);},onContactDetails:function(o){t.oCommonEventHandlers.onContactDetails(o);},onInitSmartFilterBar:function(o){C.onInitSmartFilterBarExtension(o);I();},onEditStateFilterChanged:function(o){o.getSource().fireChange();},onBeforeSFBVariantSave:function(){var o=e();s.oSmartFilterbar.setFilterData({_CUSTOM:o.customData});f(o);},onAfterSFBVariantLoad:function(){var D=s.oSmartFilterbar.getFilterData();if(D._CUSTOM!==undefined){l(D._CUSTOM);}else{var o=d();n(o[c]);n(o[g]);l(o);}f();},onBeforeRebindTable:function(o){t.oCommonEventHandlers.onBeforeRebindTable(o);C.onBeforeRebindTableExtension(o);},onShowDetails:function(o){var i=o.getSource();t.oCommonEventHandlers.onShowDetails(i);},onShowDetailsIntent:function(o){var i=o.getSource();t.oCommonEventHandlers.onShowDetailsIntent(i,s.oSmartFilterbar);},onListNavigate:function(o){var i=o.getSource();t.oCommonEventHandlers.onListNavigate(i);},onListNavigateIntent:function(o){var i=o.getSource();t.oCommonEventHandlers.onListNavigateIntent(i,s.oSmartFilterbar);},onCallAction:function(o){t.oCommonEventHandlers.onCallActionFromList(o,s.oSmartFilterbar);},onCallActionFromList:function(o){t.oCommonEventHandlers.onCallActionFromList(o);},onBeforeSemanticObjectLinkPopoverOpens:function(o){var i=t.oCommonUtils.getNavigationHandler();if(i){var p=o.getParameters();var q=s.oSmartFilterbar.getDataSuiteFormat();i.processBeforeSmartLinkPopoverOpens(p,q);}else{o.getParameters().open();}},onSearchButtonPressed:function(){var M=C.getOwnerComponent().getModel();M.attachEventOnce('requestSent',function(){f();});},onSemanticObjectLinkPopoverLinkPressed:function(){f();},onAfterTableVariantSave:function(){f();},onAfterApplyTableVariant:function(){f();},onShareEmailPress:function(){f();sap.m.URLHelper.triggerEmail(null,t.oCommonUtils.getText("EMAIL_HEADER",[t.oCommonUtils.getText("PAGEHEADER")]),document.URL);},onShareInJamPress:function(){f();var o=sap.ui.getCore().createComponent({name:"sap.collaboration.components.fiori.sharing.dialog",settings:{object:{id:document.URL,share:t.oCommonUtils.getText("PAGEHEADER")}}});o.open();},onInlineDataFieldForAction:function(o){var i=o.getSource();var p=t.oCommonUtils.getElementCustomData(i);var q=t.oCommonUtils.getParentTable(i);var u=q.getParent().getTableBindingPath();t.oServices.oCRUDManager.callAction({functionImportPath:p.Action,contexts:[i.getBindingContext()],sourceControl:q,label:p.Label,operationGrouping:"",navigationProperty:""}).then(function(v){if(v){var w=v[0];if(w.response&&w.response.context&&(!w.actionContext||w.actionContext&&w.response.context.getPath()!==w.actionContext.getPath())){t.oServices.oNavigationController.setMeToDirty(this.getOwnerComponent(),u);}}});},onInlineDataFieldForIntentBasedNavigation:function(o){var i=o.getSource();var p=t.oCommonUtils.getElementCustomData(i);var q=t.oCommonUtils.getParentTable(i);var u=t.oCommonUtils.getNavigationHandler();if(u){var v={};v=i.getBindingContext().getObject();delete v.__metadata;var w=s.oSmartFilterbar.getDataSuiteFormat()||"{}";v=t.oCommonUtils.extractODataEntityPropertiesFromODataJSONFormattedEntity(v);var x=u.mixAttributesAndSelectionVariant(v,w).toJSONString();var y={selectionVariant:s.oSmartFilterbar.getDataSuiteFormat(),tableVariantID:q.getParent().getCurrentVariantId()};u.navigate(p.SemanticObject,p.Action,x,y,function(z){if(z instanceof sap.ui.generic.app.navigation.service.NavError){sap.m.MessageBox.show(z.getErrorCode(),{title:t.oCommonUtils.getText("ST_GENERIC_ERROR_TITLE")});}});}}},formatters:{formatNewObjectTooltip:m,formatDraftLink:function(D,i,H){if(D&&D.DraftUUID){if(!i){return t.oCommonUtils.getText("DRAFT_OBJECT");}else if(H){return t.oCommonUtils.getText(D.InProcessByUser?"LOCKED_OBJECT":"UNSAVED_CHANGES");}}return"";},formatDraftIcon:function(D,i,H){if(D&&D.DraftUUID&&i&&H){if(D.InProcessByUser){return"sap-icon://locked";}else{return"sap-icon://request";}}return"";}},extensionAPI:new E(t,C,s)};}};});
