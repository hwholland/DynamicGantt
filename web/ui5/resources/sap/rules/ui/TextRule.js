/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2016 SAP SE. All rights reserved
	
 */
sap.ui.define(["jquery.sap.global","./library","sap/m/Label","sap/rules/ui/RuleBase","sap/m/Panel","sap/ui/core/Title","sap/ui/layout/form/Form","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/Text","sap/m/Button","sap/ui/layout/Grid","sap/ui/layout/form/FormContainer","sap/ui/layout/form/FormElement","sap/rules/ui/ExpressionAdvanced","sap/m/Link","sap/m/FlexBox","sap/m/Dialog","sap/rules/ui/TextRuleSettings"],function(q,l,L,R,P,T,F,a,b,c,B,G,d,e,E,f,g,D,h){"use strict";var k={vocabulary:"vocabulary",rule:"rule",verticalLayout:"verticalLayout"};var m=R.extend("sap.rules.ui.TextRule",{metadata:{properties:{enableSettings:{type:"boolean",group:"Misc",defaultValue:false},enableElse:{type:"boolean",defaultValue:true},enableElseIf:{type:"boolean",defaultValue:true}},aggregations:{"_toolbar":{type:"sap.m.Toolbar",multiple:false,singularName:"_toolbar"},"_verticalLayout":{type:"sap.ui.core.Control",multiple:false,visibility:"visible",singularName:"_verticalLayout"}}},_addConditionBlock:function(o,t){var i=this;var j=this._getModel();var s=o.getSource();var p=s.getParent();if(t===this.typeElseIf&&!(p instanceof P)){p=s.getParent().getParent();}var v=p.getParent();var n=v.indexOfContent(p);var r=this._internalModel.getProperty("/ruleId");var u=this._internalModel.getProperty("/ruleVersion");var w=n+1;var x=false;var y;var K;var z={RuleId:r,RuleVersion:u};if(t===i.typeElse){K="/TextRuleDefaultBranches";x=true;}else{K="/TextRuleBranches";if(s.getParent()instanceof P){y=w;x=true;}else{y=w+1;}z.Sequence=y;}var A={};A.properties=z;A.success=function(C){i._handleVerticalLayoutDataRequested();var H={};H.verticalLayout=v;H.nIndex=n;H.bfirst=x;i._addConditionSuccess(C,i,H);if(x){s.destroy();}};A.error=function(){q.sap.log.info("Error creating "+K+"entity");};j.createEntry(K,A);},_addConditionSuccess:function(n,t,i){var C=n.Id;var o=t._getModel();var H={RuleId:n.RuleId,Id:C,RuleVersion:n.RuleVersion};var p=o.createKey("/TextRuleConditions",H);var j=new sap.ui.model.Context(o,p);o.read(p,{urlParameters:{"$expand":"TextRuleResultExpressions"},success:function(r){var v=i.verticalLayout;t.getModel("displayModel").getProperty("/textRuleConditions").push(r);t._resetContent=true;if(r.Type===t.typeElse){t.getModel("displayModel").getProperty("/textRuleConditions/Else").push(r);var s=t._createElseFormLayout(j,t.oBundle.getText("titleElse"));v.removeContent(i.nIndex);v.insertContent(s,i.nIndex);}else if(r.Type===t.typeElseIf){t.getModel("displayModel").getProperty("/textRuleConditions/ElseIf").push(r);var u=t._createFormLayout(j,t.oBundle.getText("titleElseIf"));if(i.bfirst){v.removeContent(i.nIndex);v.insertContent(u,i.nIndex);}else{v.insertContent(u,i.nIndex+1);}}t._dataPartReceived(k.verticalLayout);},error:function(){q.sap.log.info("Error reading TextRuleResultExpressions");}});},_addToolBar:function(){var t=new a({design:"Transparent",enabled:"{TextRuleModel>/editable}"});var o=new sap.m.Title({text:this.oBundle.getText("textRule")});var s=new B({text:"",press:this._openTextRuleSettings.bind(this),visible:{parts:[{path:"TextRuleModel>/enableSettings"},{path:"TextRuleModel>/editable"}],formatter:this._decideSettingsEnablement},enabled:{parts:[{path:"TextRuleModel>/enableSettings"},{path:"TextRuleModel>/editable"}],formatter:this._decideSettingsEnablement}}).setTooltip(this.oBundle.getText("settings"));s.setIcon("sap-icon://action-settings");t.addContent(o);t.addContent(new b({}));t.addContent(s);t.addContent(new b({width:"1em"}));this.setAggregation("_toolbar",t,true);},_addTextRuleControl:function(){this.verticalLayout=new sap.ui.layout.VerticalLayout({width:"100%",busy:"{TextRuleModel>/busyVerticalLayoutState}"});this.setAggregation("_verticalLayout",this.verticalLayout,true);},_bindRule:function(){var t=this;var M=this._getModel();var s=[this._getBindModelName(),this.getBindingContextPath()].join("");this._handleRuleDataRequested();this._handleVerticalLayoutDataRequested();if(s&&M){M.setDeferredGroups(["read"]);M.read(s,{groupId:"read",urlParameters:{"$expand":"TextRule"}});var i=[s,"/TextRule/TextRuleResults"].join("");M.read(i,{groupId:"read"});i=[s,"/TextRule/TextRuleConditions"].join("");M.read(i,{groupId:"read",urlParameters:{"$expand":"TextRuleResultExpressions"}});M.submitChanges({groupId:"read",success:function(j){var o=sap.ui.getCore().getEventBus();o.publish("sap.ui.rules","refreshTextRuleModel");t._handleRuleDataReceived(j);t._handleVerticalLayoutDataReceived(j);},error:function(){q.sap.log.info("Error reading TextRule data from backend");}});}},_bindVerticalLayout:function(){var I=this._getIfPanel();this.verticalLayout.addContent(I);if(this.getEnableElseIf()===true){var o=this._getElseIfPanel();for(var i=0;i<o.length;i++){this.verticalLayout.addContent(o[i]);}}if(this.getEnableElse()===true){var j=this._getElsePanel();this.verticalLayout.addContent(j[0]);}},_createFormLayout:function(C,t){var i=this;var p=new P({expandable:true,expanded:true,headerText:t,height:"100%",backgroundDesign:"Translucent",content:new F({editable:true,layout:new sap.ui.layout.form.ResponsiveGridLayout({labelSpanXL:2,labelSpanL:2,labelSpanM:2,labelSpanS:12,adjustLabelSpan:false,emptySpanXL:4,emptySpanL:4,emptySpanM:4,emptySpanS:4,columnsL:1,columnsM:1}),formContainers:[this._createIfBlockFormContainer(C,t),this._createThenFormContainer(C,this.oBundle.getText("then"))]})}).addStyleClass("sapTextRulePanel");if(t===this.typeIf){p.setHeaderText(t);}else{var o=new a({design:"Transparent"});var j=new sap.m.Title({text:t});var A=new B({visible:{parts:[{path:"TextRuleModel>/enableSettings"},{path:"TextRuleModel>/editable"}],formatter:this._decideSettingsEnablement},enabled:{parts:[{path:"TextRuleModel>/enableSettings"},{path:"TextRuleModel>/editable"}],formatter:this._decideSettingsEnablement},text:this.oBundle.getText("addButton"),tooltip:this.oBundle.getText("addNewElseIf"),press:function(r){i._addConditionBlock(r,i.typeElseIf);}}).setBindingContext(C);var n=new B({text:this.oBundle.getText("deleteButton"),tooltip:this.oBundle.getText("deleteElseIf"),visible:{parts:[{path:"TextRuleModel>/enableSettings"},{path:"TextRuleModel>/editable"}],formatter:this._decideSettingsEnablement},enabled:{parts:[{path:"TextRuleModel>/enableSettings"},{path:"TextRuleModel>/editable"}],formatter:this._decideSettingsEnablement},press:function(r){i._deleteConditionBlock(r);}}).setBindingContext(C);o.addContent(j);o.addContent(new b({width:"900px"}));o.addContent(A);o.addContent(new b({width:"0.5px"}));o.addContent(n);p.setHeaderToolbar(o);}return p;},_createElseFormLayout:function(C,t){var i=this;var o=new a({design:"Transparent"});var j=new sap.m.Title({text:t});var n=new B({text:this.oBundle.getText("deleteButton"),tooltip:this.oBundle.getText("deleteElse"),visible:{parts:[{path:"TextRuleModel>/enableSettings"},{path:"TextRuleModel>/editable"}],formatter:this._decideSettingsEnablement},enabled:{parts:[{path:"TextRuleModel>/enableSettings"},{path:"TextRuleModel>/editable"}],formatter:this._decideSettingsEnablement},press:function(r){i._deleteConditionBlock(r);}}).setBindingContext(C);o.addContent(j);o.addContent(new b({width:"965px"}));o.addContent(n);var p=new P({expandable:true,expanded:true,height:"100%",backgroundDesign:"Translucent",content:new F({editable:true,layout:new sap.ui.layout.form.ResponsiveGridLayout({labelSpanXL:2,labelSpanL:2,labelSpanM:2,labelSpanS:12,adjustLabelSpan:false,emptySpanXL:4,emptySpanL:4,emptySpanM:4,emptySpanS:4,columnsL:1,columnsM:1}),formContainers:[this._createThenFormContainer(C,t)]})}).addStyleClass("sapTextRulePanel");p.setHeaderToolbar(o);return p;},_createIfBlockFormContainer:function(C,t){var i=C.getProperty("Expression");var j=new d({formElements:[new e({label:new L({text:""}),fields:[this._getExpressionAdvancedText(C,i)]})]});return j;},_createThenFormContainer:function(C,t){var n=new d({visible:false});if(C.getProperty("Type")!=this.typeElse){var o=new a({content:[new b({width:"2em"}),new L({text:t}).addStyleClass("sapTextRuleFontSize")]});n.setToolbar(o);}var s=C.getProperty("Id");var p=this.getModel("displayModel").getProperty("/textRuleConditions");for(var i=0;i<p.length;i++){if(s===p[i].Id){var r=p[i].TextRuleResultExpressions.results;if(r){for(var j=0;j<r.length;j++){var H={RuleId:r[j].RuleId,ConditionId:r[j].ConditionId,ResultId:r[j].ResultId,RuleVersion:r[j].RuleVersion};var u=this._getModel().createKey("/TextRuleResultExpressions",H);var v=new sap.ui.model.Context(this._getModel(),u);n.addFormElement(this._formElementsFactory(t+"result"+j,v));}}}}var w=n.getFormElements();for(var x in w){if(w[x].getVisible()){n.setVisible(true);break;}}return n;},_createTextRuleSettings:function(){var M=this._getModel();var C=this.getBindingContext();var t=new h({expressionLanguage:this.getExpressionLanguage(),newTextRule:this._internalModel.getProperty("/newTextRule")});var s=JSON.stringify(this._settingsModel.getData());var i=JSON.parse(s);var j=new sap.ui.model.json.JSONModel(i);t.setModel(j);t.setModel(this._internalModel,"TextRuleModel");t.setModel(M,"oDataModel");t.setBindingContext(C,"dummy");return t;},_dataPartReceived:function(p){this.dataReceived[p]=true;if(!this._isAllDataReceived()){return;}this._updateBusyState();this._dataLoaded.resolve();},_dataPartRequested:function(p){this.dataReceived[p]=false;this._setDataLoadedPromise();this._updateBusyState();},_decideSettingsEnablement:function(i,j){return i&&j;},_deleteConditionBlock:function(o){var t=this;var i=this._getModel();var s=o.getSource();var p=s.getParent().getParent();var v=p.getParent();var n=v.indexOfContent(p);var j=s.getBindingContext();var C=j.getProperty("Id");var r=j.getProperty("Type");var K;if(r===t.typeElse){K="/TextRuleDefaultBranches";}else if(r===t.typeElseIf){K="/TextRuleBranches";}var H={RuleId:j.getProperty("RuleId"),Id:C,RuleVersion:j.getProperty("RuleVersion")};var u=i.createKey(K,H);var _=function(){t._resetContent=true;var p;v.removeContent(n);if(r===t.typeElse){t.getModel("displayModel").setProperty("/textRuleConditions/Else",[]);p=t._getElsePanel();v.insertContent(p[0],n);}else{if(n===1&&v.getContent().length<=2){t.getModel("displayModel").setProperty("/textRuleConditions/ElseIf",[]);p=t._getElseIfPanel();v.insertContent(p[0],n);}else{var w=t.getModel("displayModel").getProperty("/textRuleConditions/ElseIf");for(var x in w){if(w[x].Id===C){w.splice(x,1);t.getModel("displayModel").setProperty("/textRuleConditions/ElseIf",w);break;}}}}t._dataPartReceived(k.verticalLayout);};this._handleVerticalLayoutDataRequested();i.remove(u,{success:function(w){_();},error:function(){q.sap.log.info("Error deleting "+K+"entity");}});},_formRuleData:function(C,i){var j=this.getBindingContextPath();var r=j.split("/")[2];var o=C.getProperty("RuleId");var v=C.getProperty("Version");var n=q.extend({},this.getModel().oData);n=n[r];if(!n){n={};}if(!n.DecisionTable){n.DecisionTable={};}n.Type="DT";n.DecisionTable.metadata={};n.DecisionTable.RuleID=o;n.DecisionTable.version=v;n.DecisionTable.HitPolicy="FM";n.DecisionTable.DecisionTableColumns={};n.DecisionTable.DecisionTableColumns.results=[];n.DecisionTable.DecisionTableColumns.results.push({"metadata":{},"RuleId":o,"Id":1,"Version":v,"Sequence":1,"Type":"CONDITION","Condition":{"metadata":{},"RuleId":o,"Id":1,"Version":v,"Expression":i,"Description":null,"ValueOnly":false,"FixedOperator":null},"Result":null});n.DecisionTable.DecisionTableRows={};n.DecisionTable.DecisionTableRows.results=[];n.DecisionTable.DecisionTableColumnsCondition={};n.DecisionTable.DecisionTableColumnsCondition.results=[];n.DecisionTable.DecisionTableColumnsResult={};n.DecisionTable.DecisionTableColumnsResult.results=[];return n;},_formElementsFactory:function(i,C){var r=C.getProperty("ResultId"),j=C.getProperty("RuleId"),v=C.getProperty("RuleVersion"),V=true;var H={RuleId:j,Id:r,RuleVersion:v};var n=C.getProperty("Expression");var o=C.getModel().createKey("/TextRuleResults",H);this._internalModel.getProperty("/textRuleResults").push(C.getModel().getProperty(o));this._internalModel.getProperty("/textRuleResultExpressions").push(C.getModel().getProperty(C.getPath()));var p=C.getModel().getProperty(o+"/BusinessDataType");var s=C.getModel().getProperty(o+"/DataObjectAttributeName");var A=C.getModel().getProperty(o+"/AccessMode");if(A==="Editable"){V=true;}else if(A==="Hidden"){V=false;}var t=new e({visible:V,label:new L({text:s,tooltip:s}),fields:[this._getExpressionAdvancedText(C,n,p)]});return t;},_getBindModelName:function(){var p="";var i=this.getModelName();if(i){p=i+">";}return p;},_getBlankContent:function(){var o=new L({text:this.oBundle.getText("startTextRule")});var s=new c();s.setText("\u00a0");var i=new f({enabled:{parts:[{path:"TextRuleModel>/enableSettings"},{path:"TextRuleModel>/editable"}],formatter:this._decideSettingsEnablement},text:" "+this.oBundle.getText("settings"),press:[this._openTextRuleSettings,this]}).addStyleClass("sapTextRuleLink");var j=new g({justifyContent:"Center",items:[o,s,i],visible:{parts:[{path:"TextRuleModel>/enableSettings"},{path:"TextRuleModel>/editable"}],formatter:this._decideSettingsEnablement}}).addStyleClass("sapUiMediumMargin");return j;},_getConvertedExpression:function(i,j,C){var o=sap.ui.getCore().byId(this.getExpressionLanguage());var r=this._formRuleData(C,i);var n;if(j){n=o.convertRuleToCodeValues(r);}else{n=o.convertRuleToDisplayValues(r);}return n;},_getDataLoadedPromise:function(){if(!this._dataLoaded){this._setDataLoadedPromise();}return this._dataLoaded.promise();},_getElseButton:function(){var t=this;this.oElseButton=new sap.m.Button({id:"_elseButton",text:this.oBundle.getText("addElse"),tooltip:this.oBundle.getText("addElse"),enabled:"{TextRuleModel>/editable}",press:function(o){t._addConditionBlock(o,t.typeElse);}});return this.oElseButton;},_getElseIfButton:function(){var t=this;this.oElseIfButton=new sap.m.Button({id:"_elseIfButton",text:this.oBundle.getText("addElseIf"),tooltip:this.oBundle.getText("addElseIf"),enabled:"{TextRuleModel>/editable}",press:function(o){t._addConditionBlock(o,t.typeElseIf);}});return this.oElseIfButton;},_getElseIfPanel:function(){var t=this.oBundle.getText("titleElseIf");var C=[];var o=this._displayModel.getProperty("/textRuleConditions/ElseIf");if(o.length>0){for(var i=0;i<o.length;i++){var H={RuleId:o[i].RuleId,Id:o[i].Id,RuleVersion:o[i].RuleVersion};var p=this._getModel().createKey("/TextRuleConditions",H);var j=new sap.ui.model.Context(this._getModel(),p);C.push(this._createFormLayout(j,t));}}else{var n=new P({headerText:t,visible:{parts:[{path:"TextRuleModel>/enableSettings"},{path:"TextRuleModel>/editable"}],formatter:this._decideSettingsEnablement},content:this._getElseIfButton()});C.push(n);}return C;},_getElsePanel:function(){var t=this.oBundle.getText("titleElse");var C=[];var o=this._displayModel.getProperty("/textRuleConditions/Else");if(o.length>0){var H={RuleId:o[0].RuleId,Id:o[0].Id,RuleVersion:o[0].RuleVersion};var p=this._getModel().createKey("/TextRuleConditions",H);var i=new sap.ui.model.Context(this._getModel(),p);C.push(this._createElseFormLayout(i,t));}else{var j=new P({headerText:t,visible:{parts:[{path:"TextRuleModel>/enableSettings"},{path:"TextRuleModel>/editable"}],formatter:this._decideSettingsEnablement},content:this._getElseButton()});C.push(j);}return C;},_getExpressionAdvancedText:function(C,i,j){var t=this;var o=sap.ui.getCore().byId(this.getExpressionLanguage());var s=j?j:sap.rules.ui.ExpressionType.NonComparison;var r=t._getConvertedExpression(i,false,C);var n=t._getExpressionFromParseResults(i,r);return new E({expressionLanguage:o,placeholder:this.oBundle.getText("expressionPlaceHolder"),validateOnLoad:true,type:s,value:n,editable:"{TextRuleModel>/editable}",change:function(p){var S=p.getSource();var C=S.getBindingContext();var u=C.getPath();var r=t._getConvertedExpression(S.getValue(),true,C);var v=t._getExpressionFromParseResults(S.getValue(),r);t._updateModelExpression(u,C,v);t._resetContent=true;}.bind(this)}).setBindingContext(C);},_getExpressionFromParseResults:function(i,r){if(r.output.decisionTableData.DecisionTable.DecisionTableColumns.results[0].Condition.parserResults.converted){return r.output.decisionTableData.DecisionTable.DecisionTableColumns.results[0].Condition.parserResults.converted.Expression;}else{return i;}},_getIfPanel:function(){var t=this.oBundle.getText("titleIf");var i=this._displayModel.getProperty("/textRuleConditions/If");var H={RuleId:i[0].RuleId,Id:i[0].Id,RuleVersion:i[0].RuleVersion};var p=this._getModel().createKey("/TextRuleConditions",H);var C=new sap.ui.model.Context(this._getModel(),p);return this._createFormLayout(C,t);},_getModel:function(){var i=this.getModelName();if(i){return this.getModel(i);}return this.getModel();},_handleRuleDataRequested:function(){this._dataPartRequested(k.rule);},_handleRuleDataReceived:function(i){if(i){this._dataPartReceived(k.rule);}},_handleVerticalLayoutDataReceived:function(r){var i=r.__batchResponses[2].data;if(!i){return;}var v=this.getAggregation("_verticalLayout");if(i.results&&i.results.length===0){var j=this._getBlankContent();v.addContent(j);this._internalModel.setProperty("/newTextRule",true);}else{this._segregateTextRuleData(i.results);if(this._displayModel.getProperty("/textRuleConditions/If").length===0){var j=this._getBlankContent();v.addContent(j);this._internalModel.setProperty("/newTextRule",true);}else{this._bindVerticalLayout();this._internalModel.setProperty("/newTextRule",false);}}this._dataPartReceived(k.verticalLayout);},_handleVerticalLayoutDataRequested:function(){this._dataPartRequested(k.verticalLayout);},_handleVocabularyDataChanged:function(o){var i=o.getParameter("data");if(i){this._handleVocabularyDataReceived(i);}else{this._handleVocabularyDataRequested();}},_handleVocabularyDataRequested:function(){this._dataPartRequested(k.vocabulary);},_handleVocabularyDataReceived:function(i){if(i){this._dataPartReceived(k.vocabulary);}},_initDataReceieved:function(){var v=false;var o=sap.ui.getCore().byId(this.getExpressionLanguage());if(o&&o._isDataExist()){v=true;}this.dataReceived={vocabulary:v,rule:false,verticalLayout:false};},_initDisplayModel:function(){var i={};i.textRuleConditions=[];i.textRuleConditions.If=[];i.textRuleConditions.ElseIf=[];i.textRuleConditions.Else=[];this._displayModel=new sap.ui.model.json.JSONModel(i);this.setModel(this._displayModel,"displayModel");},_initInternalModel:function(){var i={};i.editable=this.getEditable();i.newTextRule=true;i.busyState=true;i.enableSettings=true;i.busyVerticalLayoutState=true;i.projectId="";i.projectVersion="";i.ruleId="";i.ruleVersion="";i.ruleBindingPath="";i.textRuleResults=[];i.textRuleResultExpressions=[];this._internalModel=new sap.ui.model.json.JSONModel(i);this.setModel(this._internalModel,"TextRuleModel");},_initSettingsModel:function(){this._settingsModel=new sap.ui.model.json.JSONModel();this.setModel(this._settingsModel,"settingModel");},_isAllDataReceived:function(){var i=this.dataReceived;return i.rule&&i.verticalLayout&&i.vocabulary;},_openTextRuleSettings:function(){var t=this._createTextRuleSettings();var o=new D({contentWidth:"70%",title:this.oBundle.getText("textRuleSettings")});o.addContent(t);var j=t.getButtons(o);for(var i=0;i<j.length;i++){o.addButton(j[i]);}o.attachBeforeClose(function(n){var p=o.getState();if(p===sap.ui.core.ValueState.Success){this._resetControl();}o.destroy();},this);o.open();},_resetControl:function(){this._unbindVerticalLayout();this._initDataReceieved();this._initInternalModel();this._initSettingsModel();this._initDisplayModel();this._updateBusyState();var M=this._getModel();var i=this.getBindingContextPath();if(!i||!M){return;}this._resetContent=false;var s=i.split("'");this._internalModel.setProperty("/projectId",s[1]);this._internalModel.setProperty("/projectVersion",s[3]);this._internalModel.setProperty("/ruleId",s[5]);this._internalModel.setProperty("/ruleVersion",s[7]);this._internalModel.setProperty("/ruleBindingPath",i);var C=new sap.ui.model.Context(M,i);this.setBindingContext(C);this._bindRule();},_segregateTextRuleData:function(j){var C=[];C.If=[];C.ElseIf=[];C.Else=[];for(var i=0;i<j.length;i++){C.push(j[i]);if(j[i].Type===this.typeIf){C.If.push(j[i]);}else if(j[i].Type===this.typeElseIf){C.ElseIf.push(j[i]);}else if(j[i].Type===this.typeElse){C.Else.push(j[i]);}}this.getModel("displayModel").setProperty("/textRuleConditions",C);},_setDataLoadedPromise:function(){if(!this._dataLoaded||this._dataLoaded.state()!="pending"){this._dataLoaded=new q.Deferred();}},_updateBusyState:function(){var i=this.dataReceived;var j=i.rule&&i.verticalLayout&&i.vocabulary;var n=!j;this._internalModel.setProperty("/busyState",n);var V=!i.verticalLayout;this._internalModel.setProperty("/busyVerticalLayoutState",V);},_unbindVerticalLayout:function(){var v=this.getAggregation("_verticalLayout");v.destroyContent();},_updateModelExpression:function(p,C,i){C.getModel().setProperty(p+"/Expression",i,C,true);},init:function(){this.oBundle=sap.ui.getCore().getLibraryResourceBundle("sap.rules.ui.i18n");this.typeIf="If";this.typeElseIf="ElseIf";this.typeElse="Else";this._resetContent=true;this._initInternalModel();this._initDataReceieved();this._initDisplayModel();this._initSettingsModel();this._addToolBar();this._addTextRuleControl();},onBeforeRendering:function(){if(this._resetContent){this._resetControl();}},setEnableSettings:function(v){this.setProperty("enableSettings",v,true);this._internalModel.setProperty("/enableSettings",v);return this;},setModelName:function(v){this.setProperty("modelName",v);this._resetContent=true;return this;},setExpressionLanguage:function(v){this.setAssociation("expressionLanguage",v,true);var i=(v instanceof Object)?v:sap.ui.getCore().byId(v);if(!i){return this;}var V=this.getAggregation("_verticalLayout");if(V){var j=V.getBinding("content");if(j){j.refresh();}}if(i._isDataExist()){var o=new sap.ui.base.Event("","",{data:true});this._handleVocabularyDataChanged(o);}i.attachDataChange(this._handleVocabularyDataChanged.bind(this));return this;},setEditable:function(v){this.setProperty("editable",v,true);this._internalModel.setProperty("/editable",v);return this;},setBindingContextPath:function(v){var o=this.getBindingContextPath();if(v&&(o!=v)){this._unbindVerticalLayout();this._initDataReceieved();this.setProperty("bindingContextPath",v);this._resetContent=true;}return this;}});return m;},true);
